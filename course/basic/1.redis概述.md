# [Redis](https://redis.io/) 概述

![redis-logo](https://tva1.sinaimg.cn/large/008i3skNgy1gtgjv6tmi8j616w0dw74v02.jpg)

**Redis是一个免费开源的、基于键值(Key-Value)的高性能缓存型数据库。**

Redis(Remote Dictionary Server，远程字典服务)是一个开源的使用C语言编写的、可基于内存亦可持久化的高性能Key-Value数据库，并提供了多种语言的API。

## 前世今生

08年的时候有一个意大利西西里岛的小伙子，笔名`antirez（invece.org/）`，创建了一个访客信息网站`LLOOGG.COM`。这个访客信息网站主要用来统计网站的访问信息，如访客的 IP、操作系统、浏览器、使用的搜索关键词、所在地区、访问的网页地址等等。其实，在国内，有很多网站提供了这个功能，比如 CNZZ，百度统计等，国外也有谷歌的 Google Analytics。

`LLOOGG.COM`提供的就是这种功能，它可以查看最多 10000 条的最新浏览记录。这样的话，它需要为每一个网站创建一个列表（List），不同网站的访问记录进入到不同的列表。如果列表的长度超过了用户指定的长度，它需要把最早的记录删除（先进先出）。

![lloogg](https://tva1.sinaimg.cn/large/008i3skNly1gtgq2pjt3ej60o00eggn102.jpg)

当 LLOOGG.COM 的用户越来越多的时候，它需要维护的列表数量也越来越多，这种记录最新的请求和删除最早的请求的操作也越来越多。LLOOGG.COM 最初使用的数据库是 MySQL，可想而知，因为每一次记录和删除都要读写磁盘，因为数据量和并发量太大，在这种情况下无论怎么去优化数据库都不管用了。

考虑到最终限制数据库性能的瓶颈在于磁盘，所以`antirez`打算放弃磁盘，自己去实现一个具有列表结构的数据库的原型，把数据放在内存而不是磁盘，这样可以大大地提升列表的 push 和 pop 的效率。

`antirez`发现这种思路确实能解决这个问题，所以用C语言重写了这个内存数据库，并且加上了持久化的功能，于是，Redis横空出世了。从最开始只支持列表的数据库，到现在支持多种数据类型，并且提供了一系列的高级特性， Redis已经成为一个在全世界被广泛使用的开源项目。

### Redis 发展历史
* 2009年4月10日：Redis 初始版本发布。
* 2013年5月之前：其开发由 VMware 赞助。
* 2013年5月至2015年6月期间，其开发由 Pivotal 赞助。
* 2015年4月1日：Redis 3.0.0 版本正式发布，最重要的特征是对 Redis 集群的支持（Redis Cluster）。
* 2015年6月开始：Redis 的开发由 Redis Labs 赞助。
* 2017年7月14日：Redis 4.0.0 版本正式发布，其中最大变化就是加入了模块系统。
* 2018年10月17日：Redis 5.0 GA 正式版发布，其中比较大的变化是增加了新的流数据类型。

## 独有特色

俗话说，`打铁还得自身硬`, Redis能有今天的发展盛况，离不开自己的硬本事，那么Redis有哪些硬本事呢？

* **速度快：** 到底有多快？官方出的数据是`10W QPS`,相比磁盘的读写，Redis将数据存储在内存中，所以读写速度极快。另外，Redis使用C语言编写，核心代码才`23000`行，及其精简与优雅。
* **持久化：** 我们知道，内存数据库有个致命的问题是：断电之后数据丢失。Redis从设计之初就考虑到了这一点，能够将内存中的数据异步的保持到磁盘上。
* **多种数据结构：** Redis主要支持五种数据结构：`String`, `List`, `Hash`, `Set`, `Order Set`。除了这五个数据结构，还提供了`位图(BitMaps)`，`HyperLogLog(超小内存唯一值计数)`，`GEO(地理信息定位)`等。
* **多语言客户端：** Redis提供了基于HTTP的通信协议，所以很重主流的编程语言都支持，比如`Java`,`PHP`,`Python`,`Ruby`,`Lua`,`Node`等。
* **功能丰富：** 除了支持多种数据结构之外，还能够实现发布订阅的功能，事务，pipeline，以及使用Lua脚本自定义一些实现。
* **主从复制：** Redis为我们提供了主从复制架构的相关配置，为高可用架构的实现奠定了基础。
* **分布式架构：** Redis 3.2之后提供了集群功能，为高并发，高可用提供了有力保障。

## 使用场景

由于Redis的独有特色，我们可以将Redis使用在如下的场景中：

1. **缓存：** Redis最初的设计就是以缓存著称，所以大部分中大型网站都在用Redis作为缓存，合理的利用缓存不仅能够提升网站访问速度，还能大大降低数据库的压力。
2. **计数器：** 什么是计数器？如电商网站商品的浏览量、视频网站视频的播放数等。为了保证数据实时效，每次浏览都得给+1，并发量高时如果每次都请求数据库操作无疑是种挑战和压力。Redis提供的incr命令来实现计数器功能，内存操作，性能非常好，非常适用于这些计数场景。
3. **排行榜：** 很多网站都有排行榜应用的，如京东的月度销量榜单、商品按时间的上新排行榜等。Redis提供的有序集合数据类构能实现各种复杂的排行榜应用。
4. **消息队列：** Redis也提供了发布订阅的功能，需要注意的是，Redis使用的是阻塞队列来实现，所以简单的队列没啥问题，但是不能和专业的消息中间件对比。
5. **社交网络：** 点赞、踩、关注/被关注、共同好友等是社交网站的基本功能，社交网站的访问量通常来说比较大，而且传统的关系数据库类型不适合存储这种类型的数据，Redis提供的哈希、集合等数据结构能很方便的的实现这些功能。
6. **最新列表：** Redis列表结构，LPUSH可以在列表头部插入一个内容ID作为关键字，LTRIM可用来限制列表的数量，这样列表永远为N个ID，无需查询最新的列表，直接根据ID去到对应的内容页即可。
7. **分布式锁：** 在很多互联网公司中都使用了分布式技术，分布式技术带来的技术挑战是对同一个资源的并发访问，如全局ID、减库存、秒杀等场景，并发量不大的场景可以使用数据库的悲观锁、乐观锁来实现，但在并发量高的场合中，利用数据库锁来控制资源的并发访问是不太理想的，大大影响了数据库的性能。可以利用Redis的setnx功能来编写分布式的锁，如果设置返回1说明获取锁成功，否则获取锁失败，实际应用中要考虑的细节要更多。

## 安装配置

### 源代码下载与安装

Redis一般用于服务器端的下载和安装，所以一般用于Linux/Mac系统的下载使用，下载地址请参考这里：[Redis download](https://redis.io/download)

源代码编译安装方式：
```bash
$ wget https://download.redis.io/releases/redis-6.2.5.tar.gz
$ tar xzf redis-6.2.5.tar.gz
$ cd redis-6.2.5
$ make
```

启动方式：
```bash
src/redis-server
```

连接：
```bash
$ src/redis-cli
redis> set foo bar
OK
redis> get foo
"bar"
```

### 使用docker下载与安装：

上面的这种下载和安装方式对于手动在服务器端安装和配置较为方便，但是对于个人电脑来说，docker安装方式更加简单和高效：

安装与启动：
```bash
docker run redis --name my_redis
```

连接：
```bash
docker run -it --name my-redis-cli --link my_redis:redis --rm redis redis-cli -h redis -p 6379
```



