# Redis集群（Redis Cluster）

![redis-cluster](https://tva1.sinaimg.cn/large/008i3skNgy1gynyobc562j31hc0u0goe.jpg)

前面我们通过学习持久化，主从复制和哨兵机制，基本上就可以搭建一个比较强悍的Redis集群出来了，这个集群通常可以满足大部分的业务需求。比如并发量在10万/秒以内，存储内存在256G以内的业务应该是可以轻松应对了，但是如果你的业务需求比这个还要恐怖呢？比如百万级的并发量和大数据的需求呢？这个时候，我们就需要呼唤Redis Cluster出厂了！

## 集群概述

> Redis Cluster is a full mesh where every node is connected with every other node using a TCP connection.

Redis 集群是一个完整的网格，其中每个节点都使用 TCP 连接与每个其他节点连接。

Redis 集群为以下目标而设计：

* High performance and linear scalability up to 1000 nodes. There are no proxies, asynchronous replication is used, and no merge operations are performed on values.
* Acceptable degree of write safety: the system tries (in a best-effort way) to retain all the writes originating from clients connected with the majority of the master nodes. Usually there are small windows where acknowledged writes can be lost. Windows to lose acknowledged writes are larger when clients are in a minority partition.
* Availability: Redis Cluster is able to survive partitions where the majority of the master nodes are reachable and there is at least one reachable replica for every master node that is no longer reachable. Moreover using replicas migration, masters no longer replicated by any replica will receive one from a master which is covered by multiple replicas.

要实现上面的目标，首先要考虑数据的分布式存储：

## 数据分片

为了提高并发量和大量数据的存储，Redis Cluster使用数据分片的办法把数据分配到不同的节点；每个节点可以有自己的备份节点（一个或多个）。整个集群之上另有一个叫做Redis Sentinel的分布式组件用以提供更丰富的HA能力。

![redis-slice-data](https://tva1.sinaimg.cn/large/008i3skNgy1gynzigpxn3j30p20b70u2.jpg)

通常而言，实现数据分片有两种方式，一种是顺序分片，另一种是Hash分片。

* **顺序分片**：顾名思义，数据的顺序分片就是将数据按照一定的顺序分别放置在不同的节点上，每个节点承载的数据大体上一致。
* **Hash分片**：对数据取Hash值之后按照节点数进行取余(Hash(data) % node)，按照余数依次将其放置在不同的节点上。

![hash-slice](https://tva1.sinaimg.cn/large/008i3skNgy1gynzp2vcauj30yl0dijt2.jpg)

其优缺点和不同如下：

![hash-sort](https://tva1.sinaimg.cn/large/008i3skNgy1gynzs8by16j30mv0aat9y.jpg)




